<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Minimal APIs in C#: A Step Past the Beginner’s Guide" /><meta property="og:locale" content="en" /><meta name="description" content="Introduction: Being in the C# space for over six plus years. You get in the habit of doing things the dotnet way. I personally like that dotnet is very vocal in patterns and how to structure things. With the release of dotnet 6 we have access to Minimal APIs. While C# pays my bills and is my personal favorite. (followed by swift it has been growing on me) I have used other languages. When I first saw Minimal APIs my brain just went to similar Express and Flask, example below. Both of those frameworks have been out for years. I have used both to make some cool things. So my first thought was “How do I increase the cyclomatic complexity?”" /><meta property="og:description" content="Introduction: Being in the C# space for over six plus years. You get in the habit of doing things the dotnet way. I personally like that dotnet is very vocal in patterns and how to structure things. With the release of dotnet 6 we have access to Minimal APIs. While C# pays my bills and is my personal favorite. (followed by swift it has been growing on me) I have used other languages. When I first saw Minimal APIs my brain just went to similar Express and Flask, example below. Both of those frameworks have been out for years. I have used both to make some cool things. So my first thought was “How do I increase the cyclomatic complexity?”" /><link rel="canonical" href="https://jrdev.io//posts/Minimal-API-A-Step-Past-The-Beginners-Guide/" /><meta property="og:url" content="https://jrdev.io//posts/Minimal-API-A-Step-Past-The-Beginners-Guide/" /><meta property="og:site_name" content="Jr Dev" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-06-12T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Minimal APIs in C#: A Step Past the Beginner’s Guide" /><meta name="twitter:site" content="@sigfualt" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-06-12T00:00:00-05:00","datePublished":"2023-06-12T00:00:00-05:00","description":"Introduction: Being in the C# space for over six plus years. You get in the habit of doing things the dotnet way. I personally like that dotnet is very vocal in patterns and how to structure things. With the release of dotnet 6 we have access to Minimal APIs. While C# pays my bills and is my personal favorite. (followed by swift it has been growing on me) I have used other languages. When I first saw Minimal APIs my brain just went to similar Express and Flask, example below. Both of those frameworks have been out for years. I have used both to make some cool things. So my first thought was “How do I increase the cyclomatic complexity?”","headline":"Minimal APIs in C#: A Step Past the Beginner’s Guide","mainEntityOfPage":{"@type":"WebPage","@id":"https://jrdev.io//posts/Minimal-API-A-Step-Past-The-Beginners-Guide/"},"url":"https://jrdev.io//posts/Minimal-API-A-Step-Past-The-Beginners-Guide/"}</script><title>Minimal APIs in C#: A Step Past the Beginner’s Guide | Jr Dev</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Jr Dev"><meta name="application-name" content="Jr Dev"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://raw.githubusercontent.com/KamRon-67/jrdev.io/master/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Jr Dev</a></div><div class="site-subtitle font-italic">Keeping software simple</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/KamRon-67" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/sigfualt" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['cameronyoung','cmmsolutions.io'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Minimal APIs in C#: A Step Past the Beginner’s Guide</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Minimal APIs in C#: A Step Past the Beginner’s Guide</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Cameron Young </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Jun 12, 2023, 12:00 AM -0500" >Jun 12, 2023<i class="unloaded">2023-06-12T00:00:00-05:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1157 words">6 min read</span></div></div><div class="post-content"><p>Introduction: Being in the C# space for over six plus years. You get in the habit of doing things the dotnet way. I personally like that dotnet is very vocal in patterns and how to structure things. With the release of dotnet 6 we have access to Minimal APIs. While C# pays my bills and is my personal favorite. (followed by swift it has been growing on me) I have used other languages. When I first saw Minimal APIs my brain just went to similar Express and Flask, example below. Both of those frameworks have been out for years. I have used both to make some cool things. So my first thought was “How do I increase the cyclomatic complexity?”</p><p>Hello World Examples:</p><div class="language-js highlighter-rouge"><div class="code-header" text-data="js"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">Hello, World!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nf">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</pre></table></code></div></div><div class="language-csharp highlighter-rouge"><div class="code-header" text-data="csharp"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">MapGet</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="s">"Hello, World!"</span><span class="p">);</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header" text-data="python"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
  <span class="k">return</span> <span class="sh">"</span><span class="s">Hello, World!</span><span class="sh">"</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
  <span class="n">app</span><span class="p">.</span><span class="nf">run</span><span class="p">()</span>
</pre></table></code></div></div><p>What are Minimal APIs? Minimal APIs are a simplified way to define and implement HTTP endpoints in C#. There is way more to it especially when you get into how top level statements work in all of this. I don’t use the other part of the definition from the docs, when explaining Minimal APIs. The documentation is not incorrect, but I am thinking about impact vs. intent. The intent or purpose of why this feature was released and the impact is what we achieve with it as a community. I don’t have an answer for that yet. Minimal API’s are not going to replace what we are doing now and may projects may start off as Minimal APIs then grow into a normal api project.</p><p>Setting Up the Environment: To begin, you’ll need to have the following prerequisites installed on your machine:</p><ol><li>.NET 6.0 SDK or later<li>An Integrated Development Environment (IDE) such as Visual Studio 2022 or Visual Studio Code.</ol><p>Creating a Minimal API Project:</p><ol><li>Open your preferred IDE and create a new C# project.<li>Select the ASP.NET Core Web Application template.<li>Choose the Minimal API template to create a project specifically for minimal APIs.</ol><p>Defining Endpoints: With a minimal API project created, it’s time to define your endpoints. Let’s start by creating a simple “Hello, World!” endpoint.</p><ol><li>Open the <code class="language-plaintext highlighter-rouge">Program.cs</code> file, modify it to look like the following:</ol><div class="language-csharp highlighter-rouge"><div class="code-header" text-data="csharp"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">DataContext</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
    <span class="n">options</span><span class="p">.</span><span class="nf">UseSqlite</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"DefaultConnection"</span><span class="p">)));</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseHttpsRedirection</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">MapGet</span><span class="p">(</span><span class="s">"/car"</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="n">DataContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Cars</span><span class="p">.</span><span class="nf">ToListAsync</span><span class="p">());</span>

<span class="n">app</span><span class="p">.</span><span class="nf">MapGet</span><span class="p">(</span><span class="s">"/car/{id}"</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="n">DataContext</span> <span class="n">context</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">=&gt;</span> 
    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Cars</span><span class="p">.</span><span class="nf">FindAsync</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">is</span> <span class="n">Cars</span> <span class="n">car</span> <span class="p">?</span>
    <span class="n">Results</span><span class="p">.</span><span class="nf">Ok</span><span class="p">(</span><span class="n">car</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">Results</span><span class="p">.</span><span class="nf">NotFound</span><span class="p">(</span><span class="s">"Sorry, car not found."</span><span class="p">));</span>
</pre></table></code></div></div><ol><li>Note: I am not going over how to set up ef core and run a migration. I don’t want to deviate from the core point too much. Even in the example I am using sqlite just to get some data to play with.</ol><div class="language-csharp highlighter-rouge"><div class="code-header" text-data="csharp"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>    <span class="k">public</span> <span class="k">class</span> <span class="nc">DataContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">DataContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="p">&lt;</span><span class="n">DataContext</span><span class="p">&gt;</span> <span class="n">options</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="p">{</span>

        <span class="p">}</span>

        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Cars</span><span class="p">&gt;</span> <span class="n">Cars</span> <span class="p">=&gt;</span> <span class="n">Set</span><span class="p">&lt;</span><span class="n">Cars</span><span class="p">&gt;();</span>
    <span class="p">}</span>
</pre></table></code></div></div><div class="language-csharp highlighter-rouge"><div class="code-header" text-data="csharp"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Cars</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Make</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Year</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

</pre></table></code></div></div><p>Problem: This is one of those great clean examples. I don’t live in a clean world. How would one structure this to handle a non-trivial amount of API calls? Small projects, the requirements are going to change, there will be a few “Can we sneak this in real quickly?”.</p><p>A Possible solution: Removing things from the Program file.</p><p>I would start by removing the IServiceCollection items. This is something that has the possibility to grow, right now I am passing the DataContext around and that is a big no no. If I was to just add the repository pattern this section will grow.</p><p>So something like this: <code class="language-plaintext highlighter-rouge">builder.Services.AddScopped&lt;ICarRepository, CarRepository&gt;();</code> This is just one, this could also grow depending on our needs. I would hate for this to be in the Project.cs file with the API calls.</p><p>First update:</p><div class="language-csharp highlighter-rouge"><div class="code-header" text-data="csharp"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="nf">RegisterServices</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseHttpsRedirection</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">MapGet</span><span class="p">(</span><span class="s">"/car"</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="n">DataContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Cars</span><span class="p">.</span><span class="nf">ToListAsync</span><span class="p">());</span>

<span class="n">app</span><span class="p">.</span><span class="nf">MapGet</span><span class="p">(</span><span class="s">"/car/{id}"</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="n">DataContext</span> <span class="n">context</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">=&gt;</span> 
    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Cars</span><span class="p">.</span><span class="nf">FindAsync</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">is</span> <span class="n">Cars</span> <span class="n">car</span> <span class="p">?</span>
    <span class="n">Results</span><span class="p">.</span><span class="nf">Ok</span><span class="p">(</span><span class="n">car</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">Results</span><span class="p">.</span><span class="nf">NotFound</span><span class="p">(</span><span class="s">"Sorry, car not found."</span><span class="p">));</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>

 
<span class="k">void</span> <span class="nf">RegisterServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddScopped</span><span class="p">&lt;</span><span class="n">ICarRepository</span><span class="p">,</span> <span class="n">CarRepository</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">DataContext</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
    <span class="n">options</span><span class="p">.</span><span class="nf">UseSqlite</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"DefaultConnection"</span><span class="p">)));</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This is a method but this could be its own class, whatever works for us. The goal is just to remove some of the set up code from the Program.cs file.</p><p>Fun Fact: The code below would have worked as well. I just made it verbose so I could move it around more if I wanted too. If you have not used top level statements this might look odd since the builder is not passed in. The way top level statements work, it is behind the scenes compiling a main and a start up class for you. So long in Program.cs builder is in scope wherever you use it.</p><div class="language-csharp highlighter-rouge"><div class="code-header" text-data="csharp"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">void</span> <span class="nf">RegisterServices</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddScopped</span><span class="p">&lt;</span><span class="n">ICarRepository</span><span class="p">,</span> <span class="n">CarRepository</span><span class="p">&gt;();</span>
    <span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">DataContext</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
    <span class="n">options</span><span class="p">.</span><span class="nf">UseSqlite</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"DefaultConnection"</span><span class="p">)));</span>
<span class="p">}</span>
</pre></table></code></div></div><p>I am liking what we have going on here.</p><p>I would like to pull out those map calls out of the program file.</p><div class="language-csharp highlighter-rouge"><div class="code-header" text-data="csharp"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>    <span class="k">public</span> <span class="k">class</span> <span class="nc">ClientApi</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">ClientApi</span><span class="p">()</span>
        <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Register</span><span class="p">(</span><span class="n">WebApplication</span> <span class="n">app</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">app</span><span class="p">.</span><span class="nf">MapGet</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="s">"Hello, World!"</span><span class="p">);</span>

            <span class="n">app</span><span class="p">.</span><span class="nf">MapGet</span><span class="p">(</span><span class="s">"/hello/{name}"</span><span class="p">,</span> <span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="s">$"Hello, </span><span class="p">{</span><span class="n">name</span><span class="p">}</span><span class="s">!"</span><span class="p">);</span>

            <span class="n">app</span><span class="p">.</span><span class="nf">MapGet</span><span class="p">(</span><span class="s">"/car"</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="n">DataContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">=&gt;</span>
                <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Cars</span><span class="p">.</span><span class="nf">ToListAsync</span><span class="p">());</span>

            <span class="n">app</span><span class="p">.</span><span class="nf">MapGet</span><span class="p">(</span><span class="s">"/car/{id}"</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="n">DataContext</span> <span class="n">context</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">=&gt;</span>
                <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Cars</span><span class="p">.</span><span class="nf">FindAsync</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">is</span> <span class="n">Cars</span> <span class="n">car</span> <span class="p">?</span>
                <span class="n">Results</span><span class="p">.</span><span class="nf">Ok</span><span class="p">(</span><span class="n">car</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">Results</span><span class="p">.</span><span class="nf">NotFound</span><span class="p">(</span><span class="s">"Sorry, car not found."</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

</pre></table></code></div></div><p>After adding the ClientApi class I am fully able to reduce the Program.cs class to this.</p><div class="language-csharp highlighter-rouge"><div class="code-header" text-data="csharp"><button data-original-title="Copied!"><i class="far fa-clone"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">MinimalApi</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseHttpsRedirection</span><span class="p">();</span>

<span class="k">new</span> <span class="nf">ClientApi</span><span class="p">().</span><span class="nf">Register</span><span class="p">(</span><span class="n">app</span><span class="p">);</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>

<span class="k">void</span> <span class="nf">RegisterServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">DataContext</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
    <span class="n">options</span><span class="p">.</span><span class="nf">UseSqlite</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"DefaultConnection"</span><span class="p">)));</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Conclusion: We could do more, we could even use reflection to get our mapping. After playing with Minimal APIs my biggest takeaway is the new freedom you get to do things your own ways. Remember, this blog post only scratches the surface of what minimal APIs can do. Continue exploring the ASP.NET Core documentation and examples to dive deeper into this exciting new feature.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/api/'>API</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/c/" class="post-tag no-text-decoration" >C#</a> <a href="/tags/minimal/" class="post-tag no-text-decoration" >Minimal</a> <a href="/tags/python/" class="post-tag no-text-decoration" >Python</a> <a href="/tags/js/" class="post-tag no-text-decoration" >JS</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Minimal APIs in C#: A Step Past the Beginner’s Guide - Jr Dev&url=https://jrdev.io//posts/Minimal-API-A-Step-Past-The-Beginners-Guide/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Minimal APIs in C#: A Step Past the Beginner’s Guide - Jr Dev&u=https://jrdev.io//posts/Minimal-API-A-Step-Past-The-Beginners-Guide/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Minimal APIs in C#: A Step Past the Beginner’s Guide - Jr Dev&url=https://jrdev.io//posts/Minimal-API-A-Step-Past-The-Beginners-Guide/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Clean-Architecture-Take-Away-Part-1/">Clean Architecture Take Away Part 1</a><li><a href="/posts/Working-With-WebApplicationFactory/">Working With WebApplicationFactory</a><li><a href="/posts/Jumping-Into-Testing/">Using Tests To Speed up FeedBack Loop</a><li><a href="/posts/Intro-To-DI-Aggregation-Association-And-Composition/">Intro To DI, Aggregation Association And Composition</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/testing/">Testing</a> <a class="post-tag" href="/tags/aspnet-core/">aspnet core</a> <a class="post-tag" href="/tags/prototype-chain/">Prototype Chain</a> <a class="post-tag" href="/tags/tdd/">TDD</a> <a class="post-tag" href="/tags/testing-framework/">Testing Framework</a> <a class="post-tag" href="/tags/visual-studio/">Visual Studio</a> <a class="post-tag" href="/tags/proto/">__proto__</a> <a class="post-tag" href="/tags/aggregation/">Aggregation</a> <a class="post-tag" href="/tags/api/">API</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Jumping-Into-Testing/"><div class="card-body"> <span class="timeago small" >Feb 2, 2022<i class="unloaded">2022-02-02T00:00:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using Tests To Speed up FeedBack Loop</h3><div class="text-muted small"><p> Why Do I Even Care to Test? I have worked in a few code bases that only had tests at the center layers of the application. The team would rarely touch that code plus there is a good chance the test...</p></div></div></a></div><div class="card"> <a href="/posts/top-shortcuts/"><div class="card-body"> <span class="timeago small" >Nov 12, 2019<i class="unloaded">2019-11-12T00:00:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>My commonly used shortcuts</h3><div class="text-muted small"><p> Below is a list of my daily drivers. This is a windows short cut that is similar to alt tab but more aesthetically pleasing. This shortcut is just muscle memory from my Linux days. Ctrl tab ...</p></div></div></a></div><div class="card"> <a href="/posts/strategy-pattern/"><div class="card-body"> <span class="timeago small" >Feb 2, 2021<i class="unloaded">2021-02-02T00:00:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Strategy Pattern</h3><div class="text-muted small"><p> I joined this group to improve my programming skills and understanding of software concepts. In this group, there is a book list. One of those recommended books is Head First Design Patterns. In th...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Coupling-And-Cohesion/" class="btn btn-outline-primary" prompt="Older"><p>Coupling and Cohesion</p></a> <a href="/posts/Clean-Architecture-Take-Away-Part-1/" class="btn btn-outline-primary" prompt="Newer"><p>Clean Architecture Take Away Part 1</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small mb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://jrdev.io//posts/Minimal-API-A-Step-Past-The-Beginners-Guide/'; this.page.identifier = '/posts/Minimal-API-A-Step-Past-The-Beginners-Guide/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://jr-dev-1.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/sigfualt">Cameron Young</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/testing/">Testing</a> <a class="post-tag" href="/tags/aspnet-core/">aspnet core</a> <a class="post-tag" href="/tags/prototype-chain/">Prototype Chain</a> <a class="post-tag" href="/tags/tdd/">TDD</a> <a class="post-tag" href="/tags/testing-framework/">Testing Framework</a> <a class="post-tag" href="/tags/visual-studio/">Visual Studio</a> <a class="post-tag" href="/tags/proto/">__proto__</a> <a class="post-tag" href="/tags/aggregation/">Aggregation</a> <a class="post-tag" href="/tags/api/">API</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://jrdev.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-149577567-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-149577567-1'); }); </script>
